<!DOCTYPE html>
<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"><meta charset="UTF-8">
<style>
  div.settings {
      display:grid;
      grid-template-columns: max-content max-content;
      grid-gap:5px;
  }
  div.settings label       { text-align:left; }
  div.settings label:after { content: ""; }
</style>
</head>
<body>

<div class="settings">
  <label>Brush type</label> <select id="brush.type" name="brush.type"></select>
  <label>Brush size</label> <input id="brush.size" value=".025">
  <label>Brush color</label> <input id="brush.color" value="LightBlue">
  <label>Iterations</label> <input id="iterations" value="1">
</div>
<br />
<button onclick="setBrushOptions();">Set Brush Options</button>
<br /><br />

<img id="pic" src="images/red.jpg" width="100" height="100">
<canvas id="myCanvas" width="10" height="10">
<!-- <canvas id="myCanvas" width="30" height="30"> -->
  Your browser does not support the HTML5 canvas tag.
</canvas>
<br /><br />
<button id="drawImage" onclick="drawImage();">Draw Image</button>
<br /><br />
<label><button id="clearScene" onclick="clearScene();">Clear Current Scene</button></label> and move user to Z 
<input id="user.Z" value="5">
<br /><br />
<textarea id="results" cols="80" rows="20"></textarea>
<br /><br />
<button onclick="drawAsciiArt();">Draw Ascii Art</button>
<br /><br />
<textarea id="asciiArt" cols="80" rows="5">
<html><code><span class="ascii" style="color: black; background: white;
display:inline-block;
white-space:pre;
letter-spacing:0;
line-height:1.4;
font-family:'Consolas','BitstreamVeraSansMono','CourierNew',Courier,monospace;
font-size:12px;

border-width:1px;
border-style:solid;
border-color:lightgray;
"><span style="color:#1E171E;">&</span><span style="color:#1D161D;">&</span><span style="color:#1D161D;">&</span><span style="color:#211B1F;">&</span><span style="color:#201A1E;">&</span><span style="color:#231D21;">&</span><span style="color:#231D21;">&</span><span style="color:#201C1D;">&</span><span style="color:#272123;">&</span><span style="color:#2D2322;">&</span><span style="color:#2C2020;">&</span><span style="color:#332727;">&</span><span style="color:#2E2222;">&</span><span style="color:#2B1F1F;">&</span><span style="color:#2B1F1F;">&</span><span style="color:#302424;">&</span><span style="color:#392D2D;">&</span><span style="color:#322626;">&</span><span style="color:#2F2320;">&</span><span style="color:#BE4031;">#</span><span style="color:#B53931;">#</span><span style="color:#B73B33;">#</span><span style="color:#B63933;">#</span><span style="color:#B43731;">#</span><span style="color:#AF342F;">#</span><span style="color:#AE3330;">#</span><span style="color:#AC3531;">#</span><span style="color:#AC332B;">#</span><span style="color:#AA302D;">#</span><span style="color:#A42C2D;">#</span><span style="color:#A62E2D;">#</span><span style="color:#A62928;">#</span><span style="color:#AB2E2C;">#</span><span style="color:#AB2D2E;">#</span><span style="color:#B02F2A;">#</span><span style="color:#B03028;">#</span><span style="color:#B6332B;">#</span><span style="color:#B52F26;">#</span><span style="color:#C0392C;">#</span><span style="color:#BB3327;">#</span><span style="color:#C0382C;">#</span><span style="color:#C0382C;">#</span><span style="color:#BF362C;">#</span><span style="color:#BC3230;">#</span><span style="color:#B8302C;">#</span><span style="color:#BA3330;">#</span><span style="color:#B7302D;">#</span><span style="color:#B22A2A;">#</span><span style="color:#B52E2A;">#</span><span style="color:#AE2A26;">#</span><span style="color:#B02D2B;">#</span><span style="color:#AF2D2C;">#</span><span style="color:#AB2927;">#</span><span style="color:#AE2F29;">#</span><span style="color:#AD2D2A;">#</span><span style="color:#AD2E29;">#</span><span style="color:#B5362F;">#</span><span style="color:#B63730;">#</span><span style="color:#BB3C35;">#</span><span style="color:#BB3C35;">#</span><span style="color:#B93D30;">#</span><span style="color:#B93D31;">#</span><span style="color:#BC4034;">#</span><span style="color:#BC4132;">#</span><span style="color:#B83E31;">#</span><span style="color:#B94133;">#</span><span style="color:#322723;">&</span><span style="color:#3A2F2B;">&</span><span style="color:#372C28;">&</span><span style="color:#312624;">&</span><span style="color:#352A26;">&</span><span style="color:#312525;">&</span><span style="color:#2B2122;">&</span><span style="color:#261C1D;">&</span><span style="color:#2B2024;">&</span><span style="color:#2A1F23;">&</span><span style="color:#251A1E;">&</span><span style="color:#24191F;">&</span><span style="color:#231A1F;">&</span><span style="color:#2A1F25;">&</span>
</code></html>
</textarea>

<script>

    document.getElementById("pic").onload = function () {

      // create a new canvas to render image
      <!-- var canvas = document.createElement('canvas'); -->
      <!-- canvas.width = img.width; -->
      <!-- canvas.height = img.height; -->

      // create a new image to draw get image data
      <!-- img = new Image(); -->
      <!-- img.onload = function () { -->
      <!-- context.drawImage(img, 0, 0, img.width, img.height); -->
      <!-- }; -->
      <!-- img.src = 'woman.jpg'; -->

      // dynamically load images
      <!-- img = new Image(); -->
      <!-- img.src = 'woman.jpg'; -->

      // invert colors
      <!-- for (var i = 0; i < imageData.data.length; i += 4) { -->
          <!-- imageData.data[i] = 255 - imageData.data[i]; -->
          <!-- imageData.data[i + 1] = 255 - imageData.data[i + 1]; -->
          <!-- imageData.data[i + 2] = 255 - imageData.data[i + 2]; -->
          <!-- imageData.data[i + 3] = 255; -->
      <!-- } -->

      var canvas = document.getElementById("myCanvas");
      var context = canvas.getContext("2d");
      var img = document.getElementById("pic");

      /**
       https://stackoverflow.com/questions/14672746/how-to-compress-an-image-via-javascript-in-the-browser
       this should compress image data down to canvas size
       */
      context.drawImage(img, 0, 0, canvas.width, canvas.height);
      var imageData = context.getImageData(0, 0, canvas.width, canvas.height);
      context.putImageData(imageData, 0, 0);
    }

    function rgbToHex(r, g, b) {
      return "" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
    }

    function drawProjector() {
      var commandStrings = [];
          <!-- commandStrings.push("color.set.html=296bcc&brush.move.to=0,0,0&draw.path=[-1.9,17.4,0],[-4,13.5,1]"); -->
          <!-- commandStrings.push("color.set.html=296bcc&brush.move.to=0,0,0&draw.path=[-1.1,17.3,0],[-4,13.5,1]"); -->
          <!-- commandStrings.push("color.set.html=f0f2f1&brush.move.to=0,0,0&draw.path=[-0.8999999999999999,14.5,0],[-4,13.5,1]"); -->
          <!-- commandStrings.push("color.set.html=296bcc&brush.move.to=0,0,0&draw.path=[0,16.2,0],[-4,13.5,1]"); -->
          <!-- commandStrings.push("color.set.html=e9ecf0&brush.move.to=0,0,0&draw.path=[0.3999999999999999,16.1,0],[-4,13.5,1]"); -->
          <!-- commandStrings.push("color.set.html=2466cb&brush.move.to=0,0,0&draw.path=[0.3999999999999999,14.1,0],[-4,13.5,1]"); -->
          <!-- commandStrings.push("color.set.html=296bcc&brush.move.to=0,0,0&draw.path=[0.3999999999999999,13.1,0],[-4,13.5,1]"); -->
          <!-- commandStrings.push("color.set.html=2a6ccd&brush.move.to=0,0,0&draw.path=[0.8999999999999999,16.6,0],[-4,13.5,1]"); -->
          <!-- commandStrings.push("color.set.html=d6e0ed&brush.move.to=0,0,0&draw.path=[1.2999999999999998,14.5,0],[-4,13.5,1]"); -->
          <!-- commandStrings.push("color.set.html=296bcc&brush.move.to=0,0,0&draw.path=[1.7000000000000002,12.6,0],[-4,13.5,1]"); -->
          <!-- commandStrings.push("color.set.html=296bcc&brush.move.to=0,0,0&draw.path=[2.9000000000000004,15.5,0],[-4,13.5,1]"); -->
      commandStrings.push("color.set.html=020202&brush.move.to=0,0,0&draw.path=[-1.5,14,0],[-4,13.5,1]");
      commandStrings.push("color.set.html=010101&brush.move.to=0,0,0&draw.path=[-1.3,14.7,0],[-4,13.5,1]");
      commandStrings.push("color.set.html=05090b&brush.move.to=0,0,0&draw.path=[-1.1,14.6,0],[-4,13.5,1]");
      commandStrings.push("color.set.html=0f161b&brush.move.to=0,0,0&draw.path=[-0.6000000000000001,15.9,0],[-4,13.5,1]");
      commandStrings.push("color.set.html=060b0c&brush.move.to=0,0,0&draw.path=[0.20000000000000018,15.6,0],[-4,13.5,1]");
      commandStrings.push("color.set.html=030303&brush.move.to=0,0,0&draw.path=[0.2999999999999998,16.1,0],[-4,13.5,1]");
      commandStrings.push("color.set.html=050709&brush.move.to=0,0,0&draw.path=[0.3999999999999999,13.9,0],[-4,13.5,1]");
      commandStrings.push("color.set.html=2d3e47&brush.move.to=0,0,0&draw.path=[1.1,15.8,0],[-4,13.5,1]");
      commandStrings.push("color.set.html=050708&brush.move.to=0,0,0&draw.path=[1.2999999999999998,16.1,0],[-4,13.5,1]");
      commandStrings.push("color.set.html=010101&brush.move.to=0,0,0&draw.path=[1.4,15,0],[-4,13.5,1]");
      commandStrings.push("color.set.html=1c272a&brush.move.to=0,0,0&draw.path=[2.0999999999999996,14,0],[-4,13.5,1]");
      commandStrings.push("color.set.html=050505&brush.move.to=0,0,0&draw.path=[2.3,14.1,0],[-4,13.5,1]");
      sendCommands(commandStrings);
    }
    
    function drawRandomziedProjectorBeam(x, y, red, green, blue) {
      var commandStrings = [];
      randNum = Math.floor(Math.random() * 100);
      if(randNum % 100 == 0) {
        commandStrings.push("color.set.html=" + rgbToHex(red,green,blue) + "&brush.move.to=0,0,0" + 
          "&draw.path=[" + (START_X + (x/10)) + "," + (START_Y - (y/10)) + "," + START_Z + "],[" + (START_X-2) + "," + (START_Y-4) + "," + (START_Z+1) + "]");
        sendCommands(commandStrings);
      }
    }
   
    var getImageSize = function() {
      var xhr = new XMLHttpRequest();
      var img = document.getElementById('pic');
      xhr.open('HEAD', img.src, true);
      xhr.onreadystatechange = function(){
        if ( xhr.readyState == 4 ) {
          if ( xhr.status == 200 ) {
            console.log('Size in bytes: ' + xhr.getResponseHeader('Content-Length'));
          } else {
            console.log('ERROR');
          }
        }
      };
      xhr.send(null);
    }

    var START_X = -2, START_Y = 17.5, START_Z = 0;

/**
convert -delay 10 -loop 0 *.PNG eye_blink.gif
 */
    var drawImage = function() {

      var img = document.getElementById('pic');
      <!-- console.log("image dimensions: " + img.width + ":" + img.height); -->
      getImageSize();

      var CANVAS_SIZE = 10;
      var commandStrings = [];

      var canvas = document.getElementById("myCanvas");
      var context = canvas.getContext("2d");
      context.canvas.width = CANVAS_SIZE;
      context.canvas.height = CANVAS_SIZE;
      context.drawImage(img, 0, 0, canvas.width, canvas.height);
      <!-- return; -->

      sendCommands(["user.move.to=1,-2,2"]);
      <!-- drawProjector(); -->

      x = 0, y = 0;
      for (var x = 0; x < canvas.width && x < 100; x++) {
        for (var y = 0; y < canvas.height && y < 100; y++) {
          imageData = context.getImageData(x, y, canvas.width, canvas.height);
          red = imageData.data[0];
          green = imageData.data[1];
          blue = imageData.data[2];
          alpha = imageData.data[3];
          if (!(red == 0 && green == 0 && blue == 0)) {
            <!-- console.log(red + ":" + blue + ":" + green + ":" + alpha); -->
            <!-- commandStrings.push("brush.move.to=" + (START_X + x) + "," + (START_Y - y) + ",20&color.set.rgb=" + red + "," + green + "," + blue + "&" + "brush.draw=0.1"); -->

            commandStrings.push("brush.move.to=" + (START_X + (x/10)) + "," + (START_Y - (y/10)) + "," + START_Z + 
              "&color.set.html=" + rgbToHex(red,green,blue) + "&" + "brush.draw=0.1");

            <!-- drawRandomziedProjectorBeam(x, y, red, green, blue); -->
          }
        }
        sendCommands(commandStrings);
        commandStrings = [];
      }
      sendCommands(commandStrings);

    }

    var brushes = ["Light","Icing","OilPaint","Ink","ThickPaint","WetPaint","Marker","TaperedMarker","PinchedMarker","Highlighter","Flat","TaperedFlat","PinchedFlat","SoftHighlighter","Fire","Embers","Smoke","Snow","Rainbow","Stars","VelvetInk","Waveform","Splatter","DuctTape","Paper","CoarseBristles","DrWigglez","Electricity","Streamers","Hypercolor","Bubbles","NeonPulse","CelVinyl","HyperGrid","LightWire","ChromaticWave","Dots","Petal","Toon","Wire","Spikes","Lofted","Disco","Comet","ShinyHull","MatteHull","UnlitHull","Diamond","Leaves","DotMarker","Plasma","Taffy","Flat"];
    var menu = document.getElementById("brush.type");
    for (var brush of brushes) {
        var option = document.createElement("option");
        option.text = brush;
        option.name = brush;
        menu.add(option);
    }
    
    var setBrushOptions = function() {
      sendCommands([
          'color.set.html=' + document.getElementById("brush.color").value,
          'brush.size.set=' + document.getElementById("brush.size").value,
          'brush.type=' + document.getElementById("brush.type").value
      ]);
    }

    var clearScene = function() {
      sendCommands(["new"]);
      sendCommands(["brush.move.to=0,0,0","brush.look.up"]);
      sendCommands(["user.move.to=0,0," + document.getElementById("user.Z").value]);
    }

    function log(message) {
        var textarea = document.getElementById("results");
        textarea.value += `${message}\n`;
        textarea.scrollTop = textarea.scrollHeight; // Scroll to the end
    }

    var sendCommands = function(commandStrings) {
        var xmlHttp = new XMLHttpRequest();
        var url = 'http://localhost:40074/api/v1?' + commandStrings.join('&');
        log(commandStrings.join('\n'));
        xmlHttp.open('GET', url, false);
        try {
          xmlHttp.send();
        }
        catch(err) {
        }
    }

    var drawAsciiArt = function() {
      asciiArtStartX = -40, asciiArtStartXMultiplier = 0.6, asciiArtStartYMultiplier = 1.4;
      asciiArtStartY = 34;
      lineLength = 80;
      charAtX = 0, lineAtY = 0;

      var commandStrings = [];

      /**
       https://manytools.org/hacker-tools/convert-images-to-ascii-art/
       Input here is from above, Choose: Width of output=80, Use Color, Convert, Download HTML
      */
      var xmlString = document.getElementById("asciiArt").value;
      var doc = new DOMParser().parseFromString(xmlString, "text/html"); // html vs xml solved parsing ampersand characters
      list = doc.getElementsByTagName("span");
      console.log(list.length);
      
      <!-- return; -->
      
      for (let x of list) {
        asciiArtString = "";
        if ( x && x.nodeType === Node.ELEMENT_NODE && x.nodeName.toLowerCase() == "span" && x.hasAttribute("class") == false) {
          <!-- console.log(x.nodeType); -->
          <!-- console.log(x.nodeName); -->
          <!-- console.log(x.nodeValue); -->
          asciiArtString = x.textContent;
          if (!asciiArtString.replace(/\s/g, '').length) { // SKIPPING EMPTY SPACE
          } else {
            <!-- console.log(asciiArtString); -->
            /**
             I CANNOT get OB to draw the "&" character, I've tried draw.text=%26. For now, replace with "@"
             */
            if(asciiArtString == "&") {asciiArtString = "@";}
            <!-- console.log(x.attributes["style"].value); -->
            hexColor = x.attributes["style"].value.match(/[A-Fa-f0-9]{6}/);
            <!-- console.log(hexColor); -->
            // https://stackoverflow.com/questions/6627648/how-can-i-submit-a-hash-key-in-an-url-parameter
            asciiArtString = encodeURIComponent(asciiArtString);

            commandStrings.push("brush.move.to=" + ((asciiArtStartX + charAtX) * asciiArtStartXMultiplier) + "," + ((asciiArtStartY - lineAtY) * asciiArtStartYMultiplier) + ",20&" + 
              "color.set.html=" + hexColor + 
              "&draw.text=" + asciiArtString);
          }

          if (charAtX == (lineLength-1)) { // END OF LINE, PAINT, START NEW LINE
            sendCommands(commandStrings);
            commandStrings = [], charAtX = 0, lineAtY++;
          } else {
            charAtX++;
          }

        } else {
          console.log("skipping " + x.attributes["style"].value);
        }
      }
      
      sendCommands(commandStrings);

    }

    /**

python3 -m http.server

curl -v "http://localhost:40074/api/v1?brush.look.upwards"
curl -v "http://localhost:40074/api/v1?user.move.to=0,10,10"
curl -v "http://localhost:40074/api/v1?draw.text=a"
curl -v "http://localhost:40074/api/v1?brush.move.to=10,5,20&color.set.html=White&draw.text=%26"
curl -v "http://localhost:40074/api/v1?listenfor.strokes=http%3A%2F%2F127.0.01"
curl -v "http://localhost:40074/api/v1?brush.draw=1"
curl -v "http://localhost:40074/api/v1?brush.turn.y=45&brush.draw=1"
curl --data-urlencode -v "http://localhost:40074/api/v1?draw.paths=[[0,0,0],[1,0,0],[1,1,0]],[[0,0,-1],[-1,0,-1],[-1,1,-1]]"
http://localhost:40074/api/v1?draw.paths=[[0,0,0],[1,0,0],[1,1,0]],[[0,0,-1],[-1,0,-1],[-1,1,-1]]

curl -v "http://localhost:40074/api/v1?draw.path=[-0.49,3,0],[0.51,3.01,0],[0.5,4.01,0],[-0.5,4,0],[-0.49,3,0]"

curl -v "http://localhost:40074/api/v1?new"
curl -v "http://localhost:40074/api/v1?user.move.to=0,5,20"
curl -v "http://localhost:40074/api/v1?brush.type=MatteHull"
curl --get --data-urlencode "draw.path=[-0.49,3,0],[0.51,3.01,0],[0.5,4.01,0],[-0.5,4,0],[-0.49,3,0]" \
  -v http://localhost:40074/api/v1

"draw.path=[-0.5,4,0],[-0.49,3,0]" \


"Light","Icing","OilPaint","Ink","ThickPaint","WetPaint","Marker","TaperedMarker","PinchedMarker","Highlighter","Flat","TaperedFlat","PinchedFlat","SoftHighlighter","Fire","Embers","Smoke","Snow","Rainbow","Stars","VelvetInk","Waveform","Splatter","DuctTape","Paper","CoarseBristles","DrWigglez","Electricity","Streamers","Hypercolor","Bubbles","NeonPulse","CelVinyl","HyperGrid","LightWire","ChromaticWave","Dots","Petal","Toon","Wire","Spikes","Lofted","Disco","Comet","ShinyHull","MatteHull","UnlitHull","Diamond","Leaves","DotMarker","Plasma","Taffy","Flat"

     */

</script>

</body></html>